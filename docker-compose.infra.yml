services:
  activemq:
    image: rmohr/activemq:latest
    container_name: activemq
    restart: unless-stopped
    ports:
      - "8161:8161"
      - "61616:61616"

  lb:
    image: nginx:alpine
    container_name: search-lb
    restart: unless-stopped
    ports:
      - "18080:80"
    volumes:
      - ./infra/nginx/default.conf.template:/etc/nginx/templates/default.conf.template:ro
    environment:
      UPSTREAM_SERVERS: "${UPSTREAM_SERVERS:-server search:7003 resolve max_fails=3 fail_timeout=30s;}"
    depends_on:
      - search
